--[[ üöÄ DXD WarpControl (FINAL BUILD)
     - Dropdown Player Selector
     - Camera Orbit System (PC/Mobile)
     - DXD Key UI with Animation
     - Pulse FX / Access Granted Animation
     - Auto Key Cache (1 day)
     - Error handled / Syntax fixed
]]

local keyCode = "222554"
local keyFileName = "warp_key_cache.txt"
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

------------------------------------------------------------
-- üß© Key Save System
------------------------------------------------------------
local canUseFile = (type(isfile)=="function") and (type(readfile)=="function") and (type(writefile)=="function")

local function getTodayString()
	local d=os.date("*t")
	return string.format("%04d-%02d-%02d",d.year,d.month,d.day)
end

local function hasValidKey()
	if not canUseFile then return false end
	if not isfile(keyFileName) then return false end
	local ok,content=pcall(readfile,keyFileName)
	if not ok or not content then return false end
	local parts=string.split(content,"|")
	return parts[1]==keyCode and parts[2]==getTodayString()
end

local function saveKey()
	if not canUseFile then return end
	pcall(writefile,keyFileName,keyCode.."|"..getTodayString())
end

------------------------------------------------------------
-- üßπ Cleanup old GUIs
------------------------------------------------------------
pcall(function()
	for _,n in ipairs({"WarpControlGui","KeySystem"}) do
		local g=LocalPlayer:WaitForChild("PlayerGui"):FindFirstChild(n)
		if g then g:Destroy() task.wait(0.1) end
	end
end)

------------------------------------------------------------
-- ‚öôÔ∏è Warp System
------------------------------------------------------------
local active=false
local targetPlayerName=nil

local function removeHighlight()
	for _,p in ipairs(Players:GetPlayers()) do
		if p.Character and p.Character:FindFirstChild("Target_Highlight") then
			p.Character.Target_Highlight:Destroy()
		end
	end
end

local function stopEverything()
	active=false
	removeHighlight()
	targetPlayerName=nil
	task.defer(function()
		pcall(function()
			if LocalPlayer.Character then
				Camera.CameraType=Enum.CameraType.Custom
				local hum=LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
				Camera.CameraSubject=hum or LocalPlayer.Character
			end
		end)
	end)
end

local function getRandomBehindPosition(hrp)
	local back=-hrp.CFrame.LookVector
	local angle=math.rad(math.random(-90,90))
	local rotated=CFrame.fromAxisAngle(Vector3.new(0,1,0),angle):VectorToWorldSpace(back)
	local offset=rotated*math.random(3,7)
	return hrp.Position+offset
end

local function lookAt(localChar,targetChar)
	local r1=localChar:FindFirstChild("HumanoidRootPart")
	local r2=targetChar:FindFirstChild("HumanoidRootPart")
	if r1 and r2 then
		r1.CFrame=CFrame.new(r1.Position,Vector3.new(r2.Position.X,r1.Position.Y,r2.Position.Z))
	end
end

------------------------------------------------------------
-- üéÆ Camera Orbit (PC+Mobile)
------------------------------------------------------------
local cameraDistance=6
local cameraRotation=Vector2.new(0,0)
local lastTouchPos=nil

UserInputService.InputChanged:Connect(function(input,gp)
	if gp then return end
	if input.UserInputType==Enum.UserInputType.MouseMovement and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
		cameraRotation=cameraRotation-Vector2.new(input.Delta.x,input.Delta.y)*0.2
	elseif input.UserInputType==Enum.UserInputType.Touch then
		if lastTouchPos then
			local delta=input.Position-lastTouchPos
			cameraRotation=cameraRotation-Vector2.new(delta.X,delta.Y)*0.1
		end
		lastTouchPos=input.Position
	end
	if input.UserInputType==Enum.UserInputType.MouseWheel then
		cameraDistance=math.clamp(cameraDistance-input.Position.Z*2,2,25)
	end
end)
UserInputService.TouchPinch:Connect(function(_,scale)
	cameraDistance=math.clamp(cameraDistance/scale,2,25)
end)
UserInputService.TouchEnded:Connect(function() lastTouchPos=nil end)

RunService.Heartbeat:Connect(function()
	if not active or not targetPlayerName then return end
	local t=Players:FindFirstChild(targetPlayerName)
	if not(t and t.Character and LocalPlayer.Character) then return end
	local tHRP=t.Character:FindFirstChild("HumanoidRootPart")
	local lHRP=LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if tHRP and lHRP then
		pcall(function()
			lHRP.CFrame=CFrame.new(getRandomBehindPosition(tHRP))
			lookAt(LocalPlayer.Character,t.Character)
		end)
	end
	local head=t.Character:FindFirstChild("Head")
	if head then
		Camera.CameraType=Enum.CameraType.Scriptable
		local headPos=head.Position+Vector3.new(0,1.5,0)
		local rotX=CFrame.Angles(0,math.rad(cameraRotation.X),0)
		local rotY=CFrame.Angles(math.rad(cameraRotation.Y),0,0)
		local camOffset=rotX*rotY*Vector3.new(0,0,cameraDistance)
		Camera.CFrame=CFrame.new(headPos+camOffset,headPos)
	end
end)

------------------------------------------------------------
-- üß† GUI Build
------------------------------------------------------------
local screenGui=Instance.new("ScreenGui",LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name="WarpControlGui"
screenGui.ResetOnSpawn=false
screenGui.Enabled=false

local frame=Instance.new("Frame",screenGui)
frame.Size=UDim2.new(0,300,0,140)
frame.Position=UDim2.new(0.3,0,0.3,0)
frame.BackgroundColor3=Color3.fromRGB(30,30,30)
frame.Active=true frame.Draggable=true
Instance.new("UICorner",frame).CornerRadius=UDim.new(0,8)

local title=Instance.new("TextLabel",frame)
title.Size=UDim2.new(1,0,0,28)
title.BackgroundTransparency=1
title.Font=Enum.Font.GothamBold
title.TextSize=18
title.TextColor3=Color3.fromRGB(255,150,80)
title.Text="WarpControl (DXD)"

local inputFrame=Instance.new("Frame",frame)
inputFrame.Size=UDim2.new(1,-16,0,36)
inputFrame.Position=UDim2.new(0,8,0,36)
inputFrame.BackgroundTransparency=1

local textBox=Instance.new("TextBox",inputFrame)
textBox.Size=UDim2.new(1,-90,1,0)
textBox.PlaceholderText="Type username or pick from dropdown"
textBox.BackgroundColor3=Color3.fromRGB(45,45,45)
textBox.TextColor3=Color3.fromRGB(255,255,255)
textBox.ClearTextOnFocus=false
textBox.Font=Enum.Font.Gotham textBox.TextSize=10
Instance.new("UICorner",textBox).CornerRadius=UDim.new(0,6)

local uiStroke=Instance.new("UIStroke",textBox)
uiStroke.Color=Color3.fromRGB(60,60,60) uiStroke.Thickness=1.6

textBox.Focused:Connect(function()
	TweenService:Create(uiStroke,TweenInfo.new(0.2),{Color=Color3.fromRGB(100,200,255),Thickness=2.4}):Play()
end)
textBox.FocusLost:Connect(function()
	TweenService:Create(uiStroke,TweenInfo.new(0.3),{Color=Color3.fromRGB(60,60,60),Thickness=1.6}):Play()
end)

-- ‚ñº dropdown
local ddBtn=Instance.new("TextButton",inputFrame)
ddBtn.Size=UDim2.new(0,80,1,0)
ddBtn.Position=UDim2.new(1,-80,0,0)
ddBtn.Text="‚ñº Players"
ddBtn.Font=Enum.Font.GothamBold ddBtn.TextSize=14
ddBtn.BackgroundColor3=Color3.fromRGB(70,70,70)
ddBtn.TextColor3=Color3.fromRGB(255,255,255)
Instance.new("UICorner",ddBtn).CornerRadius=UDim.new(0,6)

local dropdown=Instance.new("Frame",frame)
dropdown.Size=UDim2.new(1,-16,0,140)
dropdown.Position=UDim2.new(0,8,0,76)
dropdown.BackgroundColor3=Color3.fromRGB(20,20,20)
dropdown.Visible=false
Instance.new("UICorner",dropdown).CornerRadius=UDim.new(0,8)

local scroll=Instance.new("ScrollingFrame",dropdown)
scroll.Size=UDim2.new(1,-8,1,-8)
scroll.Position=UDim2.new(0,4,0,4)
scroll.BackgroundTransparency=1
scroll.AutomaticCanvasSize=Enum.AutomaticSize.Y
scroll.ScrollBarThickness=6
local layout=Instance.new("UIListLayout",scroll)
layout.Padding=UDim.new(0,4)

local function makeEntry(plr)
	local btn=Instance.new("TextButton",scroll)
	btn.Size=UDim2.new(1,-8,0,36)
	btn.BackgroundColor3=Color3.fromRGB(40,40,40)
	btn.Text=plr.DisplayName.." ("..plr.Name..")"
	btn.Font=Enum.Font.Gotham btn.TextSize=14
	btn.TextColor3=Color3.fromRGB(255,255,255)
	Instance.new("UICorner",btn).CornerRadius=UDim.new(0,6)
	btn.MouseButton1Click:Connect(function()
		textBox.Text=plr.Name targetPlayerName=plr.Name dropdown.Visible=false
	end)
end

local function refreshDropdown()
	for _,c in ipairs(scroll:GetChildren()) do if c:IsA("TextButton") then c:Destroy() end end
	for _,p in ipairs(Players:GetPlayers()) do if p~=LocalPlayer then makeEntry(p) end end
end

ddBtn.MouseButton1Click:Connect(function()
	dropdown.Visible=not dropdown.Visible
	if dropdown.Visible then refreshDropdown() end
end)
Players.PlayerAdded:Connect(function() if dropdown.Visible then refreshDropdown() end end)
Players.PlayerRemoving:Connect(function() if dropdown.Visible then refreshDropdown() end end)

-- ‚ñ∂ Execute Button
local toggleButton=Instance.new("TextButton",frame)
toggleButton.Size=UDim2.new(1,-16,0,40)
toggleButton.Position=UDim2.new(0,8,1,-48)
toggleButton.Text="‚ñ∂ Execute"
toggleButton.BackgroundColor3=Color3.fromRGB(100,200,255)
toggleButton.Font=Enum.Font.GothamBold
toggleButton.TextColor3=Color3.fromRGB(20,20,20)
Instance.new("UICorner",toggleButton).CornerRadius=UDim.new(0,8)
local exeStroke=Instance.new("UIStroke",toggleButton)
exeStroke.Color=Color3.fromRGB(80,80,80) exeStroke.Thickness=1.8

local function setExecuteGlow(state)
	if state then
		local pulse=TweenInfo.new(0.8,Enum.EasingStyle.Sine,Enum.EasingDirection.InOut,-1,true)
		TweenService:Create(exeStroke,pulse,{Thickness=3.4,Color=Color3.fromRGB(255,140,60)}):Play()
	else
		TweenService:Create(exeStroke,TweenInfo.new(0.3),{Color=Color3.fromRGB(80,80,80),Thickness=1.8}):Play()
	end
end

toggleButton.MouseButton1Click:Connect(function()
	if active then stopEverything() setExecuteGlow(false)
		toggleButton.Text="‚ñ∂ Execute"
		toggleButton.BackgroundColor3=Color3.fromRGB(100,200,255) return end
	local name=textBox.Text and textBox.Text:match("%S+")
	if not name or name=="" then
		toggleButton.Text="‚ö† No Target"
		TweenService:Create(toggleButton,TweenInfo.new(0.25),{BackgroundColor3=Color3.fromRGB(255,70,70)}):Play()
		task.wait(1) toggleButton.Text="‚ñ∂ Execute" toggleButton.BackgroundColor3=Color3.fromRGB(100,200,255) return
	end
	local target=Players:FindFirstChild(name)
	if not target or not target.Character then
		toggleButton.Text="‚ùå Invalid Target"
		TweenService:Create(toggleButton,TweenInfo.new(0.25),{BackgroundColor3=Color3.fromRGB(255,70,70)}):Play()
		task.wait(1) toggleButton.Text="‚ñ∂ Execute" toggleButton.BackgroundColor3=Color3.fromRGB(100,200,255) return
	end
	targetPlayerName=name active=true setExecuteGlow(true)
	toggleButton.Text="‚èπ Stop"
	toggleButton.BackgroundColor3=Color3.fromRGB(255,100,100)
end)

------------------------------------------------------------
-- üîê DXD Key UI
------------------------------------------------------------
local keyGui=Instance.new("ScreenGui",LocalPlayer:WaitForChild("PlayerGui"))
keyGui.Name="KeySystem"
keyGui.ResetOnSpawn=false
keyGui.ZIndexBehavior=Enum.ZIndexBehavior.Global
keyGui.Enabled=true

local bg=Instance.new("Frame",keyGui)
bg.Size=UDim2.new(1,0,1,0) bg.BackgroundColor3=Color3.new(0,0,0) bg.BackgroundTransparency=1

local keyFrame=Instance.new("Frame",bg)
keyFrame.Size=UDim2.new(0,280,0,160)
keyFrame.Position=UDim2.new(0.5,-140,0.5,-80)
keyFrame.BackgroundColor3=Color3.fromRGB(25,25,25)
keyFrame.BackgroundTransparency=1
Instance.new("UICorner",keyFrame).CornerRadius=UDim.new(0,10)

local border=Instance.new("UIStroke",keyFrame)
border.Thickness=2 border.Color=Color3.fromRGB(0,170,255)

local title2=Instance.new("TextLabel",keyFrame)
title2.Size=UDim2.new(1,0,0,40)
title2.BackgroundTransparency=1
title2.Font=Enum.Font.GothamBold
title2.Text="DXD Key Access"
title2.TextSize=20
title2.TextColor3=Color3.fromRGB(0,180,255)

local keyBox=Instance.new("TextBox",keyFrame)
keyBox.Size=UDim2.new(1,-30,0,38)
keyBox.Position=UDim2.new(0,15,0,60)
keyBox.PlaceholderText="Enter your key here..."
keyBox.Font=Enum.Font.Gotham
keyBox.TextSize=14
keyBox.TextColor3=Color3.new(1,1,1)
keyBox.BackgroundColor3=Color3.fromRGB(40,40,40)
Instance.new("UICorner",keyBox).CornerRadius=UDim.new(0,6)

local boxStroke=Instance.new("UIStroke",keyBox)
boxStroke.Color=Color3.fromRGB(60,60,60)
keyBox.Focused:Connect(function()
	TweenService:Create(boxStroke,TweenInfo.new(0.25),{Color=Color3.fromRGB(0,200,255)}):Play()
end)
keyBox.FocusLost:Connect(function()
	TweenService:Create(boxStroke,TweenInfo.new(0.25),{Color=Color3.fromRGB(60,60,60)}):Play()
end)

local enterBtn=Instance.new("TextButton",keyFrame)
enterBtn.Size=UDim2.new(1,-30,0,40)
enterBtn.Position=UDim2.new(0,15,0,108)
enterBtn.Text="Enter"
enterBtn.Font=Enum.Font.GothamBold
enterBtn.TextSize=16
enterBtn.TextColor3=Color3.new(1,1,1)
enterBtn.BackgroundColor3=Color3.fromRGB(0,140,255)
Instance.new("UICorner",enterBtn).CornerRadius=UDim.new(0,8)

enterBtn.MouseEnter:Connect(function()
	TweenService:Create(enterBtn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(0,180,255)}):Play()
end)
enterBtn.MouseLeave:Connect(function()
	TweenService:Create(enterBtn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(0,140,255)}):Play()
end)

TweenService:Create(bg,TweenInfo.new(0.6),{BackgroundTransparency=0.4}):Play()
TweenService:Create(keyFrame,TweenInfo.new(0.6),{BackgroundTransparency=0}):Play()

local function showResult(success)
	local txt=Instance.new("TextLabel",keyFrame)
	txt.Size=UDim2.new(1,0,1,0)
	txt.BackgroundTransparency=1
	txt.Font=Enum.Font.GothamBold txt.TextSize=24 txt.TextTransparency=1
	txt.Text=success and "ACCESS GRANTED ‚úÖ" or "ACCESS DENIED ‚ùå"
	txt.TextColor3=success and Color3.fromRGB(0,200,255) or Color3.fromRGB(255,70,70)
	TweenService:Create(txt,TweenInfo.new(0.3),{TextTransparency=0}):Play()
	if success then
		for i=1,2 do
			TweenService:Create(border,TweenInfo.new(0.3),{Color=Color3.fromRGB(0,255,255)}):Play()
			task.wait(0.3)
			TweenService:Create(border,TweenInfo.new(0.3),{Color=Color3.fromRGB(0,180,255)}):Play()
			task.wait(0.3)
		end
		task.wait(0.5)
		TweenService:Create(txt,TweenInfo.new(0.4),{TextTransparency=1}):Play()
	else
		-- shake effect ‡∏ñ‡πâ‡∏≤‡πÉ‡∏™‡πà key ‡∏ú‡∏¥‡∏î
		for i=1,3 do
			TweenService:Create(keyFrame,TweenInfo.new(0.05),{Position=UDim2.new(0.5,-145,0.5,-80)}):Play()
			task.wait(0.05)
			TweenService:Create(keyFrame,TweenInfo.new(0.05),{Position=UDim2.new(0.5,-135,0.5,-80)}):Play()
			task.wait(0.05)
		end
		TweenService:Create(keyFrame,TweenInfo.new(0.2),{Position=UDim2.new(0.5,-140,0.5,-80)}):Play()
		task.wait(1)
		TweenService:Create(txt,TweenInfo.new(0.3),{TextTransparency=1}):Play()
	end
end

-- üéØ ‡∏ï‡∏£‡∏ß‡∏à key ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Enter
enterBtn.MouseButton1Click:Connect(function()
	local inputKey=tostring(keyBox.Text)
	if inputKey==keyCode then
		saveKey()
		showResult(true)
		task.wait(1)
		-- fade out UI key
		TweenService:Create(bg,TweenInfo.new(0.5),{BackgroundTransparency=1}):Play()
		TweenService:Create(keyFrame,TweenInfo.new(0.5),{BackgroundTransparency=1}):Play()
		task.wait(0.6)
		pcall(function() keyGui:Destroy() end)
		screenGui.Enabled=true
		print("‚úÖ Access Granted ‚Äî WarpControl unlocked.")
	else
		showResult(false)
	end
end)

-- üß† Skip ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ key ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
if hasValidKey() then
	pcall(function() keyGui:Destroy() end)
	screenGui.Enabled=true
else
	screenGui.Enabled=false
end

-- üö™ Destroy GUI ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Teleport ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô
LocalPlayer.OnTeleport:Connect(function()
	pcall(function()
		if screenGui then screenGui:Destroy() end
		if keyGui then keyGui:Destroy() end
	end)
end)

print("‚úÖ DXD WarpControl (FINAL) Loaded successfully by Lunarplyr üåô")
			
