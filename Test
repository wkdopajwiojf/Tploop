--[[ 
   üöÄ DXD WarpControl (Classic Key Edition)
   - ‡πÉ‡∏ä‡πâ Key GUI ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ (no animation)
   - DXD Warp UI ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏° Dropdown / Execute Glow / Error Color
   - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ô 100%
]]

-------------------------------
-- üîê Key Config
-------------------------------
local keyCode = "222554"
local keyFileName = "warp_key_cache.txt"

local canUseFile = (type(isfile) == "function") and (type(readfile) == "function") and (type(writefile) == "function")
local function getTodayString()
	local d = os.date("*t")
	return string.format("%04d-%02d-%02d", d.year, d.month, d.day)
end
local function hasValidKey()
	if not canUseFile then return false end
	if not isfile(keyFileName) then return false end
	local ok, content = pcall(readfile, keyFileName)
	if not ok or not content then return false end
	local parts = string.split(content, "|")
	return parts[1] == keyCode and parts[2] == getTodayString()
end
local function saveKey()
	if canUseFile then
		pcall(writefile, keyFileName, keyCode.."|"..getTodayString())
	end
end

-------------------------------
-- üí• Cleanup Old UIs
-------------------------------
pcall(function()
	for _, name in ipairs({"WarpControlGui", "KeySystem"}) do
		local g = game:GetService("Players").LocalPlayer:FindFirstChild("PlayerGui"):FindFirstChild(name)
		if g then g:Destroy() end
	end
end)

-------------------------------
-- üß† Services & State
-------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer
local Cam = workspace.CurrentCamera

local active = false
local targetPlayerName = nil

-------------------------------
-- ‚öôÔ∏è Helper Functions
-------------------------------
local function getRandomBehindPosition(targetHRP)
	local back = -targetHRP.CFrame.LookVector
	local angle = math.rad(math.random(-90, 90))
	local rotated = CFrame.fromAxisAngle(Vector3.new(0,1,0), angle):VectorToWorldSpace(back)
	local dist = math.random(3,7)
	return targetHRP.Position + rotated * dist
end

local function lookAtTarget(localChar, targetChar)
	local root = localChar:FindFirstChild("HumanoidRootPart")
	local tRoot = targetChar:FindFirstChild("HumanoidRootPart")
	if root and tRoot then
		root.CFrame = CFrame.new(root.Position, Vector3.new(tRoot.Position.X, root.Position.Y, tRoot.Position.Z))
	end
end

local function highlightTarget(plr)
	if not (plr and plr.Character) then return end
	if not plr.Character:FindFirstChild("Target_Highlight") then
		local h = Instance.new("Highlight")
		h.Name = "Target_Highlight"
		h.FillColor = Color3.fromRGB(255, 0, 0)
		h.FillTransparency = 0.8
		h.OutlineColor = Color3.fromRGB(0, 0, 0)
		h.Adornee = plr.Character
		h.Parent = plr.Character
	end
end

local function clearHighlights()
	for _, p in ipairs(Players:GetPlayers()) do
		if p.Character then
			local h = p.Character:FindFirstChild("Target_Highlight")
			if h then h:Destroy() end
		end
	end
end

local function stopWarp()
	active = false
	targetPlayerName = nil
	clearHighlights()
	pcall(function()
		Cam.CameraType = Enum.CameraType.Custom
		local hum = LP.Character and LP.Character:FindFirstChildWhichIsA("Humanoid")
		local head = LP.Character and LP.Character:FindFirstChild("Head")
		Cam.CameraSubject = head or hum or LP.Character
	end)
end

-------------------------------
-- üé• Camera Orbit Controls
-------------------------------
local camRot = Vector2.new(0, 0)
local camDist = 6
local lastTouch = nil
local rotSpeed, zoomSpeed = 0.2, 0.8

UIS.InputChanged:Connect(function(input, processed)
	if processed then return end
	if input.UserInputType == Enum.UserInputType.MouseMovement and UIS:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
		camRot -= Vector2.new(input.Delta.x, input.Delta.y) * rotSpeed
	elseif input.UserInputType == Enum.UserInputType.Touch then
		if lastTouch then
			local delta = input.Position - lastTouch
			camRot -= Vector2.new(delta.X, delta.Y) * (rotSpeed * 0.6)
		end
		lastTouch = input.Position
	end
	if input.UserInputType == Enum.UserInputType.MouseWheel then
		camDist = math.clamp(camDist - input.Position.Z * 2, 2, 25)
	end
end)
UIS.TouchPinch:Connect(function(_, scale)
	camDist = math.clamp(camDist / scale, 2, 25)
end)
UIS.TouchEnded:Connect(function() lastTouch = nil end)

-------------------------------
-- üåÄ Warp Loop
-------------------------------
RunService.Heartbeat:Connect(function()
	if not active or not targetPlayerName then return end
	local tp = Players:FindFirstChild(targetPlayerName)
	if not (tp and tp.Character and LP.Character) then return end

	highlightTarget(tp)
	local th = tp.Character:FindFirstChild("HumanoidRootPart")
	local lh = LP.Character:FindFirstChild("HumanoidRootPart")
	local head = tp.Character:FindFirstChild("Head")
	if th and lh then
		pcall(function() lh.CFrame = CFrame.new(getRandomBehindPosition(th)) end)
		lookAtTarget(LP.Character, tp.Character)
	end

	if head then
		Cam.CameraType = Enum.CameraType.Scriptable
		local headPos = head.Position + Vector3.new(0,1.5,0)
		local rotX = CFrame.Angles(0, math.rad(camRot.X), 0)
		local rotY = CFrame.Angles(math.rad(camRot.Y), 0, 0)
		local offset = rotX * rotY * Vector3.new(0, 0, camDist)
		Cam.CFrame = CFrame.new(headPos + offset, headPos)
	end
end)

-------------------------------
-- üß± Build GUI
-------------------------------
local SG = Instance.new("ScreenGui", LP:WaitForChild("PlayerGui"))
SG.Name = "WarpControlGui"
SG.ResetOnSpawn = false
SG.Enabled = false

local F = Instance.new("Frame", SG)
F.Size = UDim2.new(0,300,0,140)
F.Position = UDim2.new(0.3,0,0.3,0)
F.BackgroundColor3 = Color3.fromRGB(30,30,30)
F.Active, F.Draggable = true, true
Instance.new("UICorner", F).CornerRadius = UDim.new(0,8)

local T = Instance.new("TextLabel", F)
T.Size = UDim2.new(1,0,0,28)
T.Position = UDim2.new(0,0,0,6)
T.BackgroundTransparency = 1
T.Font = Enum.Font.GothamBold
T.TextSize = 18
T.TextColor3 = Color3.fromRGB(255,150,80)
T.Text = "WarpControl (DXD)"

local inputFrame = Instance.new("Frame", F)
inputFrame.Size = UDim2.new(1,-16,0,36)
inputFrame.Position = UDim2.new(0,8,0,36)
inputFrame.BackgroundTransparency = 1

local textBox = Instance.new("TextBox", inputFrame)
textBox.Size = UDim2.new(1,-90,1,0)
textBox.PlaceholderText = "Type username or pick from dropdown"
textBox.BackgroundColor3 = Color3.fromRGB(45,45,45)
textBox.TextColor3 = Color3.fromRGB(255,255,255)
textBox.TextXAlignment = Enum.TextXAlignment.Center
textBox.TextYAlignment = Enum.TextYAlignment.Center
textBox.ClearTextOnFocus = false
textBox.Font = Enum.Font.Gotham
textBox.TextSize = 10
textBox.Text = ""
Instance.new("UICorner", textBox).CornerRadius = UDim.new(0,6)

local uiStroke = Instance.new("UIStroke", textBox)
uiStroke.Thickness, uiStroke.ApplyStrokeMode = 1.6, Enum.ApplyStrokeMode.Border
uiStroke.Color = Color3.fromRGB(60,60,60)

textBox.Focused:Connect(function()
	TweenService:Create(uiStroke,TweenInfo.new(0.2),{Color=Color3.fromRGB(100,200,255),Thickness=2.5}):Play()
end)
textBox.FocusLost:Connect(function()
	TweenService:Create(uiStroke,TweenInfo.new(0.2),{Color=Color3.fromRGB(60,60,60),Thickness=1.6}):Play()
end)

-- üëá ‡∏õ‡∏∏‡πà‡∏° ddBtn ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
local ddBtn = Instance.new("TextButton", inputFrame)
ddBtn.Size = UDim2.new(0,80,1,0)
ddBtn.Position = UDim2.new(1,-80,0,0)
ddBtn.Text = "‚ñº Players"
ddBtn.Font = Enum.Font.GothamBold
ddBtn.TextSize = 14
ddBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
ddBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", ddBtn).CornerRadius = UDim.new(0,6)

-- üëá dropdown ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô
local dropdown = Instance.new("Frame", F)
dropdown.Size = UDim2.new(1,-16,0,140)
dropdown.Position = UDim2.new(0,8,0,76)
dropdown.BackgroundColor3 = Color3.fromRGB(20,20,20)
dropdown.Visible = false
Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0,8)

-- üëá ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏ß‡∏≤‡∏á effect ‡∏Ç‡∏≠‡∏á ddBtn ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å dropdown ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß
local ddStroke = Instance.new("UIStroke", ddBtn)
ddStroke.Thickness = 1.8
ddStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
ddStroke.Color = Color3.fromRGB(80,80,80)

-- hover + glow logic
ddBtn.MouseEnter:Connect(function()
	game:GetService("TweenService"):Create(ddStroke, TweenInfo.new(0.25),
		{Color = Color3.fromRGB(100,200,255), Thickness = 2.5}
	):Play()
end)
ddBtn.MouseLeave:Connect(function()
	game:GetService("TweenService"):Create(ddStroke, TweenInfo.new(0.25),
		{Color = Color3.fromRGB(80,80,80), Thickness = 1.8}
	):Play()
end)
ddBtn.MouseButton1Click:Connect(function()
	dropdown.Visible = not dropdown.Visible
	if dropdown.Visible then
		refreshDD()
		game:GetService("TweenService"):Create(ddStroke, TweenInfo.new(0.25),
			{Color = Color3.fromRGB(0,180,255), Thickness = 2.8}
		):Play()
	else
		game:GetService("TweenService"):Create(ddStroke, TweenInfo.new(0.25),
			{Color = Color3.fromRGB(80,80,80), Thickness = 1.8}
		):Play()
	end
end)

-------------------------------
-- üë• Dropdown list (with avatar & glow)
-------------------------------
local dropdown = Instance.new("Frame")
dropdown.Size = UDim2.new(1,-16,0,140)
dropdown.Position = UDim2.new(0,8,0,76)
dropdown.BackgroundColor3 = Color3.fromRGB(20,20,20)
dropdown.BorderSizePixel = 0
dropdown.Visible = false
dropdown.ZIndex = 100
dropdown.Parent = F
Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0,8)

-- üåü Glow ‡∏£‡∏≠‡∏ö dropdown
local ddGlow = Instance.new("UIStroke")
ddGlow.Thickness = 2.5
ddGlow.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
ddGlow.Color = Color3.fromRGB(0,180,255)
ddGlow.Transparency = 1
ddGlow.Parent = dropdown

-- üåÄ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î glow
local function setDropdownGlow(state)
	TweenService:Create(ddGlow, TweenInfo.new(0.25, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
		state and {Transparency = 0.2} or {Transparency = 1}
	):Play()
end

local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1,-8,1,-8)
scroll.Position = UDim2.new(0,4,0,4)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 6
scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
scroll.ZIndex = 101
scroll.Parent = dropdown

local list = Instance.new("UIListLayout")
list.Padding = UDim.new(0,4)
list.SortOrder = Enum.SortOrder.LayoutOrder
list.Parent = scroll

-- üë§ ‡∏ä‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô dropdown
local function makeEntry(p)
	local btn = Instance.new("Frame")
	btn.Size = UDim2.new(1,-8,0,40)
	btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
	btn.ZIndex = 102
	btn.Parent = scroll
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)

	-- ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
	local avatar = Instance.new("ImageLabel", btn)
	avatar.Size = UDim2.new(0,32,0,32)
	avatar.Position = UDim2.new(0,4,0.5,-16)
	avatar.BackgroundTransparency = 1
	avatar.ZIndex = 103

	task.spawn(function()
		local ok, thumb = pcall(function()
			return Players:GetUserThumbnailAsync(p.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
		end)
		if ok and thumb then
			avatar.Image = thumb
		end
	end)

	-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
	local name = Instance.new("TextButton", btn)
	name.Size = UDim2.new(1,-44,1,0)
	name.Position = UDim2.new(0,40,0,0)
	name.BackgroundTransparency = 1
	name.Text = p.DisplayName .. " (" .. p.Name .. ")"
	name.Font = Enum.Font.Gotham
	name.TextSize = 14
	name.TextColor3 = Color3.fromRGB(255,255,255)
	name.TextXAlignment = Enum.TextXAlignment.Left
	name.ZIndex = 104

	name.MouseButton1Click:Connect(function()
		textBox.Text = p.Name
		targetPlayerName = p.Name
		dropdown.Visible = false
		setDropdownGlow(false) -- üîµ ‡∏õ‡∏¥‡∏î glow ‡∏ï‡∏≠‡∏ô‡∏õ‡∏¥‡∏î
	end)
end

local function refreshDD()
	for _,c in ipairs(scroll:GetChildren()) do
		if c:IsA("Frame") then c:Destroy() end
	end
	for _,pl in ipairs(Players:GetPlayers()) do
		if pl ~= LP then
			makeEntry(pl)
		end
	end
end

ddBtn.MouseButton1Click:Connect(function()
	dropdown.Visible = not dropdown.Visible
	setDropdownGlow(dropdown.Visible) -- üí´ ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î glow ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
	if dropdown.Visible then
		refreshDD()
	end
end)

Players.PlayerAdded:Connect(function()
	if dropdown.Visible then refreshDD() end
end)
Players.PlayerRemoving:Connect(function()
	if dropdown.Visible then refreshDD() end
end)

task.delay(1,function()
	if not dropdown.Visible then
		refreshDD()
	end
end)

-------------------------------
-- ‚ñ∂ Execute Button
-------------------------------
local exe = Instance.new("TextButton", F)
exe.Size = UDim2.new(1,-16,0,40)
exe.Position = UDim2.new(0,8,1,-48)
exe.Text = "‚ñ∂ Execute"
exe.Font = Enum.Font.GothamBold
exe.TextSize = 16
exe.BackgroundColor3 = Color3.fromRGB(100,200,255)
exe.TextColor3 = Color3.fromRGB(20,20,20)
exe.TextStrokeTransparency = 1
exe.ZIndex = 1
Instance.new("UICorner", exe).CornerRadius = UDim.new(0,8)

-- üåü ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÅ‡∏™‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≤‡∏£‡πå‡∏õ (Execute Glow)
local exeStroke = Instance.new("UIStroke", exe)
exeStroke.Thickness = 1.8
exeStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
exeStroke.Color = Color3.fromRGB(80,80,80) -- ‡∏õ‡∏Å‡∏ï‡∏¥‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏∑‡∏≠‡∏á

local function setExecuteGlow(state)
	local tween = game:GetService("TweenService"):Create(
		exeStroke,
		TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
		state and
			{ Color = Color3.fromRGB(255,140,60), Thickness = 3 } -- ‡∏ï‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ‡∏™‡πâ‡∏°‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á
			or
			{ Color = Color3.fromRGB(80,80,80), Thickness = 1.8 }  -- ‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏°‡∏∑‡∏î‡πÜ
	)
	tween:Play()
end

local exeStroke = Instance.new("UIStroke", exe)
exeStroke.Thickness = 1.8
exeStroke.Color = Color3.fromRGB(80,80,80)

local function setGlow(on)
	TweenService:Create(exeStroke,TweenInfo.new(0.3), on and
		{Color=Color3.fromRGB(255,140,60),Thickness=3} or
		{Color=Color3.fromRGB(80,80,80),Thickness=1.8}
	):Play()
end

exe.MouseButton1Click:Connect(function()
	if active then
		stopWarp()
		setExecuteGlow(false)
		exe.Text = "‚ñ∂ Execute"
		exe.BackgroundColor3 = Color3.fromRGB(100,200,255)
		return
	end

	local name = textBox.Text:match("%S+")
	if not name then
		exe.Text = "‚ö† No Target"
		exe.BackgroundColor3 = Color3.fromRGB(255,70,70)
		task.wait(1)
		exe.Text = "‚ñ∂ Execute"
		exe.BackgroundColor3 = Color3.fromRGB(100,200,255)
		return
	end

	local t = Players:FindFirstChild(name)
	if not (t and t.Character) then
		exe.Text = "‚ùå Invalid Target"
		exe.BackgroundColor3 = Color3.fromRGB(255,70,70)
		task.wait(1)
		exe.Text = "‚ñ∂ Execute"
		exe.BackgroundColor3 = Color3.fromRGB(100,200,255)
		return
	end

	targetPlayerName = name
	active = true
	setExecuteGlow(true) -- ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏™‡∏á
	exe.Text = "‚èπ Stop"
	exe.BackgroundColor3 = Color3.fromRGB(255,100,100)
end)

-------------------------------
-- üîë Simple Key UI
-------------------------------
if not hasValidKey() then
	local keyGui = Instance.new("ScreenGui", LP:WaitForChild("PlayerGui"))
	keyGui.Name = "KeySystem"
	keyGui.ResetOnSpawn = false
	local frame = Instance.new("Frame", keyGui)
	frame.Size = UDim2.new(0,280,0,150)
	frame.Position = UDim2.new(0.5,-140,0.5,-75)
	frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
	Instance.new("UICorner", frame).CornerRadius = UDim.new(0,8)
	local title = Instance.new("TextLabel", frame)
	title.Size = UDim2.new(1,0,0,30)
	title.Text = "Enter Key"
    textBox.Text = ""
	title.Font = Enum.Font.GothamBold
	title.TextColor3 = Color3.fromRGB(0,180,255)
	title.BackgroundTransparency = 1
	local box = Instance.new("TextBox", frame)
	box.Size = UDim2.new(1,-30,0,36)
	box.Position = UDim2.new(0,15,0,40)
	box.PlaceholderText = "Enter your key here..."
	box.Font = Enum.Font.Gotham
	box.TextColor3 = Color3.fromRGB(255,255,255)
	box.BackgroundColor3 = Color3.fromRGB(40,40,40)
	Instance.new("UICorner", box).CornerRadius = UDim.new(0,6)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(1,-30,0,36)
	btn.Position = UDim2.new(0,15,0,90)
	btn.Text = "Confirm"
	btn.Font = Enum.Font.GothamBold
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.BackgroundColor3 = Color3.fromRGB(0,140,255)
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
	btn.MouseButton1Click:Connect(function()
		if box.Text == keyCode then
			saveKey()
			keyGui:Destroy()
			SG.Enabled = true
		else
			btn.Text, btn.BackgroundColor3 = "Invalid Key!", Color3.fromRGB(255,70,70)
			task.wait(1)
			btn.Text, btn.BackgroundColor3 = "Confirm", Color3.fromRGB(0,140,255)
		end
	end)
else
	SG.Enabled = true
end

print("‚úÖ DXD WarpControl (Classic Key Edition) Ready.")
